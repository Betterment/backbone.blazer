// Backbone.Blazer v0.0.2
!function(a,b){"object"==typeof exports?module.exports=b(require("jquery"),require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],b):b(a.$,a._,a.Backbone,a)}(this,function(a,b,c){"use strict";var d=/(\(\?)?:\w+/g,e=/\+/g;c.BaseRouter=c.Router.extend({constructor:function(){this.routeParams={},c.Router.prototype.constructor.apply(this,arguments)},onNavigate:function(){},route:function(a,d){var e,f;b.isRegExp(a)?(e=a,f=""+a):(e=this._routeToRegExp(a),f=a),this.routeParams[a]=this._extractRouteParams(f);var g={route:e,router:this,linked:d};b.isRegExp(a)||(g.originalRoute=a);var h=this;return c.history.route(e,function(a,b){var c=h._extractParameters(e,a),d=c.pop();b&&(g.navOptions=b),g.query=h._getQueryParameters(d),g.params=h._getNamedParams(f,c),g.uriFragment=a,h.onNavigate(g)}),this},_extractRouteParams:function(a){var b=[];return a.replace(d,function(a){b.push(a.substr(1))}),b},_getQueryParameters:function(a){return a?b.reduce(a.split("&"),function(a,c){var d=c.replace(e," ").split("="),f=d[0],g=d[1];return f=decodeURIComponent(f),g=void 0===g?null:decodeURIComponent(g),a[f]?b.isArray(a[f])?a[f].push(g):a[f]=[a[f],g]:a[f]=g,a},{}):{}},_getNamedParams:function(a,c){if(!c.length)return{};var d=this.routeParams[a],e=c.slice(0,d.length);return b.object(b.zip(d,e))}}),c.Blazer={},c.Blazer.Route=function(a){this.options=b.extend({},b.result(this,"options"),a),this.initialize.apply(this,arguments)},c.Blazer.Route.extend=c.Model.extend,b.extend(c.Blazer.Route.prototype,c.Events,{initialize:function(){},destroy:function(){return this.stopListening(),this},prepare:function(){},execute:function(){},error:function(){}}),c.Blazer.Router=c.BaseRouter.extend({onNavigate:function(a){var d=a.linked;if(this.currentRoute=d,b.isString(d)&&b.isFunction(this[d]))this[d].apply(this,a);else if(d instanceof c.Blazer.Route)this._handleBlazerRoute(d,a);else{if(!b.isFunction(d))throw new Error("Incorrectly configured route");d.apply(this,a)}},_handleBlazerRoute:function(b,c){var d=this;b.trigger("before:execute",c),a.when(b.prepare(c)).then(function(){d.currentRoute===b&&(b.execute(c),b.trigger("after:execute",c))}).fail(function(){var a=Array.prototype.slice.call(arguments);if(a.unshift(c),d.currentRoute===b){var e=b.error.apply(b,a)===!1;e||d.trigger("error",a)}})}})});
//# sourceMappingURL=backbone.blazer.min.js.map