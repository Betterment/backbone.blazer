// Backbone.Blazer v0.0.2
!function(a,b){"object"==typeof exports?module.exports=b(require("jquery"),require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],b):b(a.$,a._,a.Backbone,a)}(this,function(a,b,c){"use strict";c.Blazer={},c.Blazer.Route=function(a){this.options=b.extend({},b.result(this,"options"),a),this.initialize.apply(this,arguments)},c.Blazer.Route.extend=c.Model.extend,b.extend(c.Blazer.Route.prototype,c.Events,{initialize:function(){},destroy:function(){return this.stopListening(),this},prepare:function(){},execute:function(){},error:function(){}}),c.Blazer.Router=c.Router.extend({route:function(a,d){b.isRegExp(a)||(a=this._routeToRegExp(a));var e={handler:d},f=this;return c.history.route(a,function(b){e.params=f._extractParameters(a,b),f.handleRoute(e)}),this},handleRoute:function(a){var d=a.handler;if(this.currentRoute=d,b.isString(d))b.isFunction(this[d])&&this[d].apply(this,a.params);else if(d instanceof c.Blazer.Route)this._handleBlazerRoute(d,a);else{if(!b.isFunction(d))throw new Error("Incorrectly configured route");d.apply(this,a)}},_handleBlazerRoute:function(b,c){var d=this;b.trigger("before:execute",c),this._runBeforeFilters(b,c).then(function(){return a.when(b.prepare(c))}).then(function(){d.currentRoute===b&&(b.execute(c),b.trigger("after:execute",c),d._runAfterFilters(b,c))}).fail(function(){if(d.currentRoute===b){var a=Array.prototype.slice.call(arguments);a.unshift(c);var e=b.error.apply(b,a)===!0;e||d.trigger("error",a)}})},_runBeforeFilters:function(a,b){return this._runFilters("beforeRoute",a,b)},_runAfterFilters:function(a,b){return this._runFilters("afterRoute",a,b)},_runFilters:function(c,d,e){var f=(this.filters||[]).concat(d.filters||[]),g=b.compact(b.pluck(f,c)),h=a.Deferred(),i=b.reduce(g,function(b,c){return b?b.then(function(){return c(e)}):a.when(c(e))},null);return i?i.then(h.resolve):h.resolve(),h.promise()}})});
//# sourceMappingURL=backbone.blazer.min.js.map