// Backbone.Blazer v0.0.2
!function(a,b){"object"==typeof exports?module.exports=b(require("jquery"),require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],b):b(a.$,a._,a.Backbone,a)}(this,function(a,b,c){"use strict";c.Blazer={},c.Blazer.Route=function(a){this.options=b.extend({},b.result(this,"options"),a),this.initialize.apply(this,arguments)},c.Blazer.Route.extend=c.Model.extend,b.extend(c.Blazer.Route.prototype,c.Events,{initialize:function(){},destroy:function(){return this.stopListening(),this},prepare:function(){},execute:function(){},error:function(){},redirect:function(a){return{redirectFragment:a}}}),c.Blazer.Router=c.Router.extend({route:function(a,d){b.isRegExp(a)||(a=this._routeToRegExp(a));var e={handler:d},f=this;return c.history.route(a,function(b){e.params=f._extractParameters(a,b),f.handleRoute(e)}),this},handleRoute:function(a){var d=a.handler;if(this.currentRoute=d,b.isString(d))b.isFunction(this[d])&&this[d].apply(this,a.params);else if(d instanceof c.Blazer.Route)this._handleBlazerRoute(d,a);else{if(!b.isFunction(d))throw new Error("Incorrectly configured route");d.apply(this,a)}},_handleBlazerRoute:function(a,b){var c=this;a.trigger("before:execute",b),c.trigger("before:execute",b),this._runBeforeFilters(c,a,b).then(function(){return c._runHandler(a.prepare,c,a,b)}).then(function(){c.currentRoute===a&&(c._runHandler(a.execute,c,a,b),a.trigger("after:execute",b),c.trigger("after:execute",b),c._runAfterFilters(c,a,b))}).fail(function(){if(c.currentRoute===a){var d=Array.prototype.slice.call(arguments);d.unshift(b);var e;c._runHandler(function(){var b=a.error.apply(a,d);return e=b===!0,b},c,a,b),e||c.trigger("error",d)}})},_runBeforeFilters:function(a,b,c){return this._runFilters("beforeRoute",a,b,c)},_runAfterFilters:function(a,b,c){return this._runFilters("afterRoute",a,b,c)},_runFilters:function(c,d,e,f){var g=(this.filters||[]).concat(e.filters||[]),h=b.compact(b.pluck(g,c)),i=a.Deferred(),j=b.reduce(h,function(a,b){return a?a.then(function(){return d._runHandler(b,d,e,f)}):d._runHandler(b,d,e,f)},null);return j?j.then(i.resolve):i.resolve(),i.promise()},_runHandler:function(b,c,d,e){var f=b.call(d,e);return f&&f.redirectFragment?(c.navigate(f.redirectFragment,{trigger:!0}),a.Deferred().reject().promise()):a.when(f)}})});
//# sourceMappingURL=backbone.blazer.min.js.map